# PDB Chemical Component Dictionary (CIF文件) 提供的信息

## 概述

CIF (Crystallographic Information File) 是PDB化学组分字典中对每个分子的**标准化学描述**，但它**不是为分子动力学模拟设计的**。

## CIF文件包含的信息

### ✅ 提供的信息（我们可以用）

#### 1. **分子拓扑结构**
```
- 原子列表：哪些原子存在
- 键连接：哪些原子之间有化学键
- 键级：单键(SING)、双键(DOUB)、三键等
- 芳香性：是否为芳香环
```

**示例（SLL.cif）：**
```
SLL CP  OP1  DOUB N N 13    # CP=OP1 双键（羰基）
SLL CP  OP2  SING N N 14    # CP-OP2 单键
SLL OP2 HOP2 SING N N 33    # OP2上有氢（质子化形式）
```

#### 2. **三维坐标**（两种）
```
- model_Cartn_x/y/z: 来自实验晶体结构的坐标
- pdbx_model_Cartn_x/y/z_ideal: 理想化的标准几何坐标
```

**我们用的是ideal坐标**：
```python
x_ideal = float(parts[15])  # 6.325 Å
y_ideal = float(parts[16])  # -0.368 Å
z_ideal = float(parts[17])  # 0.128 Å
```

这些坐标用于：
- ✅ 生成template.in的内坐标（键长、键角、二面角）
- ✅ 生成coords.in的笛卡尔坐标

#### 3. **立体化学**
```
- 手性中心：L-氨基酸 vs D-氨基酸
- 顺反异构：E/Z构型
```

#### 4. **形式电荷（Formal Charge）**
```
_chem_comp.pdbx_formal_charge    0   # 整个分子的净电荷
_chem_comp_atom.charge           0   # 每个原子的形式电荷
```

**重要：** 这是Lewis结构中的电荷，**不是部分电荷**！
- 形式电荷：化学计数，通常是整数（-1, 0, +1）
- 部分电荷：量子化学计算，是小数（-0.5894, +0.7341）

#### 5. **化学标识符**
```
- SMILES: O=C(O)C(N)CCCCNC(=O)CCC(=O)O
- InChI: InChI=1S/C10H18N2O5/c11-7...
- 分子式: C10 H18 N2 O5
- 分子量: 246.260
```

### ❌ 不提供的信息（我们需要自己添加）

#### 1. **部分电荷（Partial Charges）**
CIF文件**没有**AMBER/CHARMM力场的部分电荷！

我们需要：
- 从标准氨基酸参数推断
- 或用量子化学计算（RESP拟合）
- 或从文献查找

**示例：**
```
# CIF文件说：
OP2的formal charge = 0

# 但AMBER需要：
OP2 (质子化-OH):  partial charge = -0.5894
OP2 (去质子化-O⁻): partial charge = -0.8000
```

#### 2. **质子化状态（Protonation State）**
CIF定义的是**化学标准状态**（通常pH=0左右），不是生理pH！

**SLL的例子：**
```
CIF文件：     -COOH (质子化，HOP2存在)
生理pH 7.4：  -COO⁻ (去质子化，无HOP2)
```

我们需要根据：
- pKa值
- 环境pH
- 蛋白质微环境

来决定用哪个质子化状态。

#### 3. **力场参数**
- ❌ 键伸缩力常数 (k_bond)
- ❌ 角弯曲力常数 (k_angle)
- ❌ 二面角参数 (V_n, γ, n)
- ❌ 范德华参数 (σ, ε)
- ❌ 溶剂化参数

这些都需要从AMBER/CHARMM标准库中查找或推断。

#### 4. **pH依赖性**
CIF只给一个质子化状态，不提供：
- pKa值
- 滴定曲线
- 不同pH下的结构

## 我们如何使用CIF文件

### 从SLL.cif生成OSPREY模板的流程

```
CIF文件 (SLL.cif)
    ↓
提取信息：
├─ ideal坐标 (x, y, z) ────────→ coords.in的原子位置
├─ 键连接 (CP=OP1, CP-OP2) ────→ template.in的键连接顺序
└─ 原子类型 (C, O, N, H) ──────→ 确定元素

手动添加：
├─ AMBER原子类型 (CT, O2, N, HC) ──→ template.in, coords.in
├─ 部分电荷 (-0.8, +0.7) ─────────→ coords.in
├─ 质子化状态 (删除HOP2) ─────────→ 去质子化-COO⁻
└─ Rotamer角度 (从LYS复制) ───────→ rotlib.dat

最终输出：
├─ K04_template.in (内坐标 + AMBER类型)
├─ K04_coords.in (笛卡尔坐标 + 电荷)
└─ K04_rotlib.dat (构象采样)
```

## 关键要点

### CIF文件是什么？
✅ **化学标准参考** - 定义分子的化学结构和标准几何
✅ **晶体学数据** - 来自X射线晶体学测定
✅ **pH无关** - 通常是中性或最稳定的质子化状态

### CIF文件不是什么？
❌ **不是力场参数文件** - 没有能量函数
❌ **不是生理pH下的结构** - 需要调整质子化状态
❌ **不是即用型模拟输入** - 需要转换为力场格式

## 我们的错误在哪里

### 问题1：直接使用CIF的质子化状态
```
CIF: -COOH (HOP2存在)
        ↓
直接用于coords.in
        ↓
错误！应该在pH 7.4用 -COO⁻
```

### 问题2：使用了质子化形式的电荷
```
从标准AMBER复制 -COOH 的电荷：
  CU  = +0.7341
  OU1 = -0.5894
  OU2 = -0.5894
        ↓
应该用 -COO⁻ 的电荷：
  CU  = +0.8
  OU1 = -0.8
  OU2 = -0.8
```

## 修正方案

1. **保留CIF的几何** (键长、键角、坐标) ✅
2. **调整质子化状态** (删除HOP2，-COOH → -COO⁻) ❌ 待修正
3. **更新部分电荷** (匹配去质子化状态) ❌ 待修正
4. **调整AMBER原子类型** (如果需要) ❌ 待检查

## 总结

**CIF文件提供：**
- 分子结构骨架（原子、键、坐标）
- 化学标准状态（不一定是生理状态）

**我们需要添加：**
- 力场参数（电荷、原子类型）
- 生理条件下的质子化状态
- 构象采样库（rotamers）

**关键教训：**
> CIF文件是化学参考，不是即用型力场文件。需要根据模拟条件（pH、溶剂、力场）进行转换和调整！
